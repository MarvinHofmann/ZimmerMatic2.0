const main = require("../index.js")
const os = require('os');
const fs = require("fs");
const si = require('systeminformation');

/**
 * Returns Information about the pi 
 * cpu usage, total memory and free memory
 */
main.app.get("/api/os_info", async function (req, res) {
    let temp = fs.readFileSync("/sys/class/thermal/thermal_zone0/temp");
    let temp_c = temp / 1000;
    let cpu = await si.cpu()
        .then((data) => {
            return data
        })
        .catch(error => console.error(error));
    let cpu_temp = await si.cpuTemperature()
        .then((data) => {
            return data
        })
        .catch(error => console.error(error));

    let memory_info = await si.mem().then((data) => {
        return data
    })
    .catch(error => console.error(error));

    let load = await si.currentLoad().then((data) => {
        return data
    })
    .catch(error => console.error(error));

    let fs = await si.diskLayout().then((data) => {
        return data
    })

    let all = await si.getStaticData().then((data) => {
        return data
    })

    let docker = await si.dockerInfo().then((data) => {
        return data
    })
    .catch(error => console.error(error));
    res.status(200).json({
        cpu_si: cpu,
        memory: memory_info,
        temp_c: temp_c,
        cpu_temp: cpu_temp,
        load: load,
        disk: fs,
        all: all,
        docker: docker
    })
});